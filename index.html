<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Textimp · Subir archivos</title>
<style>
body{margin:0;font-family:system-ui;background:#0b1220;color:#fff;min-height:100vh;display:grid;place-items:center;padding:18px}
.card{width:min(520px,100%);background:#121b34;border:1px solid rgba(255,255,255,.12);padding:18px;border-radius:18px}
input,button{width:100%;margin-top:12px}
button{background:#ff6210;color:#111;border:0;padding:12px;border-radius:12px;font-weight:800}
.log{margin-top:10px;font-size:12px;white-space:pre-wrap;color:#b9c3e6}
</style>
</head>
<body>
<div class="card">
  <h3>Subir archivos (sin compresión)</h3>
  <input type="file" id="files" multiple />
  <button id="btn">Subir</button>
  <div id="log" class="log"></div>
</div>

<script>
const WORKER_URL = "https://floral-credit-9028.01os-elizondo.workers.dev/"; // <-- REPLACE THIS

const btn = document.getElementById("btn");
const log = document.getElementById("log");

btn.onclick = async () => {
  log.textContent = "";
  const files = [...document.getElementById("files").files];
  if (!files.length) return;

  log.textContent += "Creando sesión...\n";
  const res = await fetch(`${WORKER_URL}/api/create-upload`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ files: files.map(f => ({ name: f.name, type: f.type })) })
  });
  const data = await res.json();

  for (const item of data.items) {
    const file = files.find(f => f.name.replace(/[^\w.\-() ]+/g, "_") === item.name) || files.find(f => f.name === item.name);
    log.textContent += `Subiendo ${item.name}...\n`;
    const put = await fetch(item.putUrl, {
      method: "PUT",
      headers: {"Content-Type": item.type || "application/octet-stream"},
      body: file
    });
    if (!put.ok) throw new Error("PUT failed " + put.status);
  }

  log.textContent += "✅ Listo.\n";
};
</script>
</body>
</html>
